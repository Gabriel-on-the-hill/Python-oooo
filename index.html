<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Spy School | Decryption Engine</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">

        <!-- CLASS SETUP SCREEN -->
        <section id="classSetupScreen" class="screen active center-screen">
            <h1>Spy School — Classroom Access</h1>
            <div class="form-row">
                <label>Class ID (Access Code)
                    <!-- FIXED & READONLY: SPY-ACADEMY -->
                    <input id="classIdInput" type="text" value="SPY-ACADEMY" readonly
                        style="background: #e2e8f0; cursor: not-allowed; color: #64748b; font-weight: 700;">
                </label>
            </div>
            <div class="form-row">
                <label>Student Name / ID
                    <input id="studentIdInput" type="text" placeholder="Enter your assigned Agent Name">
                </label>
            </div>
            <div class="form-row">
                <button id="btnStartClass" class="primary">ENTER MISSION</button>
            </div>
        </section>

        <!-- DIAGNOSTIC SCREEN -->
        <section id="diagnosticScreen" class="screen hidden">
            <h2>⚠️ SECURITY CLEARANCE REQUIRED</h2>
            <p>Quick diagnostic — 3 very short questions.</p>

            <div class="diagnostic-tasks">
                <div class="task-card" id="task1">
                    <h3>1. Loop Range</h3>
                    <p>What numbers does <code>range(3)</code> produce?</p>
                    <div class="options">
                        <button class="option-btn" data-correct="false">1, 2, 3</button>
                        <button class="option-btn" data-correct="true">0, 1, 2</button>
                        <button class="option-btn" data-correct="false">0, 1, 2, 3</button>
                    </div>
                </div>

                <div class="task-card hidden" id="task2">
                    <h3>2. Alphabet Index</h3>
                    <p>What is the index of 'a' in our list?</p>
                    <div class="options">
                        <button class="option-btn" data-correct="false">1</button>
                        <button class="option-btn" data-correct="true">0</button>
                        <button class="option-btn" data-correct="false">26</button>
                    </div>
                </div>

                <div class="task-card hidden" id="task3">
                    <h3>3. Cipher Math</h3>
                    <p>If <code>position = 2</code> and <code>key = 5</code>, what is <code>position - key</code>?</p>
                    <div class="options">
                        <button class="option-btn" data-correct="true">-3</button>
                        <button class="option-btn" data-correct="false">3</button>
                        <button class="option-btn" data-correct="false">7</button>
                    </div>
                </div>
            </div>

            <div id="diagnosticFeedback" class="feedback-msg"></div>
        </section>

        <!-- DECRYPTION ENGINE SCREEN -->
        <section id="decryptionScreen" class="screen hidden">
            <header class="mission-header">
                <div>
                    <h2>MISSION: DECRYPTION PROTOCOL</h2>
                    <div id="agentRank" class="agent-rank">RANK: RECRUIT</div>
                </div>
                <div class="progress-wrapper">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
            </header>

            <div class="top-controls">
                <div class="config-row">
                    <label>Encrypted Text
                        <input id="encryptedInput" type="text" value="khoor zruog" />
                    </label>

                    <label>Key
                        <input id="keyInput" type="number" value="3" min="0" max="25">
                    </label>

                    <label>Preserve Case
                        <input id="preserveCaseToggle" type="checkbox" checked>
                    </label>

                    <label>Think Mode
                        <input id="thinkModeToggle" type="checkbox">
                    </label>

                    <label>Show Explicit Index
                        <input id="explicitIndexToggle" type="checkbox">
                    </label>

                    <button id="btnStartMission" class="primary">Start Mission</button>
                </div>
            </div>

            <main class="main-interface">
                <!-- Encrypted visualizer -->
                <div class="encrypted-visualizer" id="encryptedVisualizer"></div>

                <!-- Inspector & alphabet -->
                <div class="center-grid">
                    <div class="loop-inspector-panel">
                        <div class="inspector-header">
                            <span id="iterationDisplay">Iteration: - / -</span>
                            <span id="currentLetterDisplay">Current: -</span>
                            <span id="indexDisplay">Index: -</span>
                        </div>

                        <div class="equation-display" id="equationDisplay">
                            <div class="equation-template">new_pos = (pos - key) % 26</div>
                            <div class="calculation-step" id="calcStep1"></div>
                            <div class="calculation-step" id="calcStep2"></div>
                        </div>

                        <div class="result-display">
                            <div>Result: <span id="resultLetter" class="highlight-result">-</span></div>
                            <div>Decrypted: <span id="accumulatedText" class="decrypted-text">-</span></div>
                        </div>

                        <div id="thinkPrompt" class="think-prompt hidden">
                            <div class="think-question">
                                Predict the <strong>new index</strong> for this letter and enter it:
                                <input id="predictInput" type="number" placeholder="e.g. 4">
                            </div>
                            <div class="think-actions">
                                <button id="btnReveal" class="primary">Reveal</button>
                                <button id="btnSkipPredict">Skip</button>
                            </div>
                            <div id="predictFeedback" class="small muted"></div>
                        </div>
                    </div>

                    <div class="alphabet-area">
                        <div class="alphabet-visualizer" id="alphabetVisualizer"></div>
                    </div>
                </div>
            </main>

            <!-- Playback + Controls -->
            <footer class="controls-panel">
                <div class="playback-controls">
                    <button id="btnStepBack" class="ctrl-btn">⏮ Step Back</button>
                    <button id="btnPlay" class="ctrl-btn">▶ Auto-Play</button>
                    <button id="btnPause" class="ctrl-btn hidden">⏸ Pause</button>
                    <button id="btnStepForward" class="ctrl-btn">Step Forward ⏭</button>
                    <button id="btnReset" class="ctrl-btn warning">⚠ Reset</button>
                </div>

                <div class="settings-controls">
                    <label>Speed
                        <input type="range" id="speedSlider" min="1" max="5" value="3">
                    </label>
                    <button id="btnExportData" class="secondary">Export Class CSV</button>
                </div>
            </footer>
        </section>

        <!-- THONNY TRANSITION SCREEN -->
        <section id="thonnyScreen" class="screen hidden center-screen">
            <h2>MISSION ACCOMPLISHED</h2>
            <p>Manual alignment complete. Copy this Python template into Thonny to automate it.</p>
            <div class="code-block" id="pythonCodeTemplate"></div>
            <button id="btnFinish" class="primary">Finish & Return</button>
        </section>
    </div>

    <script src="script.js"></script>
</body>

</html>